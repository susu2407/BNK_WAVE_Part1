<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WAVE CARD ADMIN</title>
    <!-- 상품 등록 -->
    <link rel="stylesheet" th:href="@{/css/admin/common/commonCSS.css}">
    <link rel="stylesheet" th:href="@{/css/admin/common/commonActionBarTable.css}">
    <link rel="stylesheet" th:href="@{/css/admin/card/register.css}">
    <script th:src="@{/js/admin/common/aside.js}"></script>
    <script th:src="@{/js/admin/card/cardForm.js}"></script>
</head>
<body>
<div th:replace="~{admin/common/header :: header}"></div>
<div th:replace="~{admin/common/aside :: aside}"></div>
<main>
    <div class="main-container">
        <div class="page-header">
            <link rel="stylesheet" th:href="@{/css/admin/common/mainHeader.css}">
            <h1 class="page-title">상품관리</h1>
            <nav class="page-breadcrumb">
                관리자 &gt; 상품관리 &gt; 상품등록
            </nav>
        </div>
        <div id="main-content">
            <form th:action="@{/admin/card/register}" method="post" enctype="multipart/form-data">
                <div class="form-wrap">
                    <!-- 1. 기본 정보 -->
                    <section class="form-section">
                        <div class="section-header">
                            <h2>기본 정보<span style="color: red">*</span></h2>
                            <p>카드 상품을 식별하는 기본 정보를 입력합니다. 상품명, 노출명, 카드 타입 등 고객에게 바로 표시되는 핵심 정보입니다.</p>
                        </div>
                        <div class="section-content">
                            <div class="form-field-wrapper">
                                <label for="name" style="width: 50px">상품명</label>
                                <input id="name" type="text" name="name" required
                                       placeholder="국문 상품명을 입력하세요." class="product-name-input">
                            </div>
                            <div class="form-field-wrapper">
                                <label for="engName" style="width: 50px">영어명</label>
                                <input id="engName" type="text" name="engName" required
                                       placeholder="영문 상품명을 입력하세요." class="product-name-input">
                            </div>
                            <div class="form-flex-wrapper">
                                <label for="type" style="width: 30px">타입</label>
                                <select name="type" id="type" required style="width: 50px">
                                    <option value="신용">신용</option>
                                    <option value="체크">체크</option>
                                </select> <br>
                                <label class="isCompany">
                                    <input type="checkbox" name="isCompany" value="true"
                                           class="company-checkbox">
                                    기업
                                </label>
                            </div>
                            <div class="form-field-wrapper full-width">
                                <label for="description" style="width: 30px;">설명</label>
                                <textarea id="description" name="description" required class="product-desc-textarea"></textarea>
                            </div>

                        </div>
                    </section>

                    <!-- 2. 연회비 -->
                    <section class="form-section">
                        <div class="section-header">
                            <h2>비용 정보 <span style="color: red">*</span></h2>
                            <p>카드 이용자에게 제고되는 혜택을 등록합니다. 적립, 할인, 제휴 혜택 등 모든 프로모션 내용을 포함할 수 있습니다.</p>
                        </div>
                        <div id="annualFeeList" class="section-content">
                            <div class="form-flex-wrapper btn-section">
                                <label>연회비</label>
                                <button type="button" class="btn annualFee-add-btn">+</button>
                            </div>
                            <div class="form-flex-wrapper btn-section annualFeeContainer">
                                <div class="form-flex-wrapper" >
                                    <select name="" id="" required>
                                        <option value="type" disabled selected hidden>타입 선택</option>
                                        <option name="region" value="국내">국내전용</option>
                                        <option name="region" value="해외">해외겸용</option>
                                    </select>
                                    <div class="input-with-unit">
                                        <input type="text" name="annualFeeName" style="width: 300px"
                                               class="product-num-input">
                                        <span class="unit">원</span>
                                    </div>
                                </div>
                                <button type="button" class="btn annualFee-remove-btn">-</button>
                            </div>
                        </div>
                    </section>

                    <!-- 3. 혜택 컨테이너 -->
                    <section class="form-section">
                        <div class="section-header">
                            <h2>혜택 정보 <span style="color: red">*</span></h2>
                            <p>
                                카드 이용자에게 제공되는 혜택을 등록합니다.<br>
                                월별 최대 혜택 금액 한도를 설정합니다.<br>
                                각 혜택을 고객에게 보여주는 내용입니다.
                            </p>
                        </div>
                        <div id="benefitList" class="section-content">
                            <div class="form-flex-wrapper btn-section">
                                <label>혜택</label>
                                <button type="button" class="btn benefit-add-btn">+</button>
                            </div>
                            <div class="form-field-wrapper btn-section">
                                <div class="form-field-wrapper benefitContainer">
                                    <div class="form-flex-wrapper">
                                        <select name="category" class="category" required>
                                            <option value="" disabled selected hidden>카테고리 선택</option>
                                            <option th:each="category : ${categoryList}"
                                                    th:value="${category.name}"
                                                    th:text="${category.name}"></option>
                                        </select>
                                        <select name="benefitType" class="benefitType" required>
                                            <option value="할인">할인</option>
                                            <option value="캐시백">캐시백</option>
                                            <option value="포인트적립">포인트적립</option>
                                        </select>
                                        <label class="input-with-unit">
                                            <input type="text" name="value" placeholder="혜택 값"
                                                   class="product-num-input" >
                                        </label>
                                        <select name="unit" class="unit" required>
                                            <option value="%">%</option>
                                            <option value="원">원</option>
                                        </select>
                                    </div>
                                    <div class="form-field-wrapper">
                                        <label>월 최대 혜택 한도</label>
                                        <label class="input-with-unit" style="width: 150px">
                                            <input type="text" name="limit" placeholder="한도 금액" style="width: 150px;"
                                                   class="product-num-input">
                                            <span class="unit">원</span>
                                        </label>
                                    </div>
                                    <div class="form-field-wrapper">
                                        <label>혜택설명</label>
                                        <label>
                                            <textarea name="benefitDescription" class="product-desc-textarea"
                                                   placeholder="예: 주유소 5% 할인"
                                                   required></textarea>
                                        </label>
                                    </div>
                                <button type="button" class="btn benefit-remove-btn" style="margin-left: auto;">-</button>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- 4. 이미지 관리`` -->
                    <section class="form-section">
                        <div class="section-header">
                            <h2>이미지 관리 <span style="color: red">*</span></h2>
                            <p>상품에 사용될 카드 이미지와 홍보용 이미지를 업로드합니다. 고객이 보는 주요 시각 요소입니다.</p>
                        </div>
                        <div class="section-content">
                            <label for="termsFile"></label>
                            <div class="file-upload-wrapper" >
                                <label for="termsFile" class="custom-file-label">파일 선택</label>
                                <span id="fileNameDisplay">선택된 파일 없음</span>
                                <input type="file" name="thumbnail"  id="termsFile" accept="image/*" required>
                            </div>
                        </div>
                    </section>

                    <!-- 5. 약관 선택 -->
                    <section class="form-section">
                        <div class="section-header">
                            <h2>약관 선택 <span style="color: red">*</span></h2>
                            <p>
                                해당 상품에 연동할 약관을 선택해 주십시오. 목록에는 승인 및 활성화된 약관만 표시됩니다. <br>
                                [ 약관구분 ] - [ 약관명 ] - [ 버전 ] 입니다.
                            </p>
                        </div>
                        <div class="section-content">
                            <select name="termsId" required>
                                <option value="" disabled selected hidden>약관 구분을 선택하세요.</option>
                                <option th:each="item : ${warningList}" th:value="${item.termsId}" th:text="${item.title}">약관</option>
                            </select>
                            <label class="terms-title">
                                <!-- 약관명 검색 입력 -->
                                <input type="text" name="title" id="titleInput" autocomplete="off"
                                       placeholder="약관명을 입력하세요." class="terms-select-input">
                            </label>
                            <!-- 검색 결과 리스트 -->
                            <div class="form-field-wrapper">
                                <ul id="suggestionBox" class="title-caution">
                                    <li th:each="item : ${warningList}"
                                        th:data-title="${item.title}"
                                        th:data-id="${item.termsId}"
                                        onclick="selectTitle(this)">
                                        <p>
                                            [[${item.title}]] - [[${item.version}]] -
                                            <span th:style="'color:' +
                                                    (${item.termStatus == '활성' ? 'green' :
                                                    (item.termStatus == '비활성' ? 'gray' :
                                                    (item.termStatus == '퇴직' ? 'red' : 'black'))})">[[${item.termStatus}]]
                                            </span>
                                        </p>
                                    </li>

                                </ul>
                            </div>
                            <!-- 선택된 약관 ID를 담는 hidden input -->
                            <input type="hidden" name="termsId" id="selectedTermsId" />
                        </div>

                    </section>

                    <div class="form-flex-wrapper btn-section-submit">
                        <a th:href="@{/admin/card/list}" class="btn register-btn">취소</a>
                        <button type="submit" class="btn register-btn">등록</button>
                    </div>

                </div>
            </form>
        </div>
    </div>
</main>
<div th:replace="~{admin/common/footer :: footer}"></div>
<script th:inline="javascript">
    const input = document.getElementById('titleInput');
    const box = document.getElementById('suggestionBox');
    const items = document.querySelectorAll('#suggestionBox > li');

    box.style.display = 'none';

    input.addEventListener('input', function() {
        const val = this.value.trim().toLowerCase();
        if (!val) return box.style.display = 'none';

        let count = 0;
        items.forEach(item => {
            const title = item.getAttribute('data-title');
            if (title && title.toLowerCase().includes(val) && count < 5) {
                item.style.display = 'block';
                count++;
            } else {
                item.style.display = 'none';
            }
        });

        box.style.display = count > 0 ? 'block' : 'none';
    });

    function selectTitle(el) {
        // 1) 입력창에 제목 넣기
        input.value = el.dataset.title;
        box.style.display = 'none';

        // 2) 선택된 termsId 가져오기
        const selectedId = el.dataset.id;

        // 3) hidden input에도 넣기
        document.getElementById('selectedTermsId').value = selectedId;

        // 4) select 박스에서 해당 옵션을 선택 상태로 변경
        const selectBox = document.querySelector('select[name="termsId"]');
        selectBox.value = selectedId;  // ⬅ 자동 선택!

        // 필요한 경우 change 이벤트 트리거
        selectBox.dispatchEvent(new Event('change'));
    }

</script>
<script>
    // input[type="file"]
    document.getElementById('termsFile').addEventListener('change', function() {
        const fileNameDisplay = document.getElementById('fileNameDisplay');

        // 파일이 선택되었는지 확인
        if (this.files && this.files.length > 0) {
            // 첫 번째 파일의 이름을 가져와 표시
            fileNameDisplay.textContent = this.files[0].name;
            fileNameDisplay.style.color = '#333'; // 텍스트 색상 변경
        } else {
            // 파일 선택이 취소된 경우
            fileNameDisplay.textContent = '선택된 파일 없음';
            fileNameDisplay.style.color = '#555';
        }
    });
</script>
</body>
</html>