<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" th:href="@{/css/common/mainContainer.css}">
    <script th:src="@{/js/common/aside.js}"></script>
</head>
<body>
<div th:replace="~{common/header :: header}"></div>
<main>
    <div class="main-container">
        <div th:replace="~{common/aside :: aside}"></div>
        <div id="main-content">
            <form th:action="@{/admin/card/register}" method="post">
                <label for="name">상품명</label>
                <input id="name" type="text" name="name" required> <br>

                <label for="engName">영어명</label>
                <input id="engName" type="text" name="engName" required> <br>

                <label for="type">타입</label>
                <select name="type" id="type" required>
                    <option value="신용">신용</option>
                    <option value="체크">체크</option>
                </select> <br>

                <label>
                    <input type="checkbox" name="isCompany" value="true"> 기업
                </label>

                <!-- 연회비 -->
                <div id="annualFeeList">
                    <div class="annualFeeContainer">
                        <label>연회비</label>
                        <input name="annualFeeName" type="text"> <br>
                        <button type="button" class="annualFee-add-btn">➕ 추가</button>
                        <button type="button" class="annualFee-remove-btn">➖ 삭제</button>
                    </div>
                </div>
                <br>

                <!-- 혜택 컨테이너 -->
                <div id="benefitList">
                    <div class="benefitContainer">
                        <label>혜택</label>
                        <select name="category" class="category" required>
                            <option value="" disabled selected hidden>카테고리 선택</option>
                            <option th:each="category : ${categoryList}"
                                    th:value="${category.name}"
                                    th:text="${category.name}"></option>
                        </select>
                        <select name="benefitType" class="benefitType" required>
                            <option value="할인">할인</option>
                            <option value="캐시백">캐시백</option>
                            <option value="포인트적립">포인트적립</option>
                        </select>
                        <input type="number" name="value" class="value" placeholder="혜택 값">
                        <select name="unit" class="unit" required>
                            <option value="%">%</option>
                            <option value="원">원</option>
                        </select>
                        <label>한도</label>
                        <input type="number" name="limit" class="limit" placeholder="한도 금액">
                        <label>설명</label>
                        <input type="text" name="benefitDescription" class="benefitDescription"
                               placeholder="예: 주유소 5% 할인"
                               required>
                        <button type="button" class="benefit-add-btn">➕ 추가</button>
                        <button type="button" class="benefit-remove-btn">➖ 삭제</button>
                    </div>
                </div>

                <br>

                <label for="description">설명</label>
                <input id="description" type="text" name="description" required> <br>

                <label for="thumbnail">이미지</label>
                <input id="thumbnail" type="file" name="thumbnail" accept="image/*"> <br>

                <button type="submit">등록</button>
            </form>
        </div>
    </div>
</main>
<div th:replace="~{common/footer :: footer}"></div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const annualFeeList = document.getElementById("annualFeeList");
        const benefitList = document.getElementById("benefitList");

        function cloneAndReset(container) {
            const clone = container.cloneNode(true);
            clone.querySelectorAll("input").forEach(input => {
                input.value = "";
                input.removeAttribute("id");
            });
            clone.querySelectorAll("select").forEach(select => {
                select.selectedIndex = 0;
            });
            return clone;
        }

        // 연회비 추가/삭제
        annualFeeList.addEventListener("click", function (e) {
            if (e.target.classList.contains("annualFee-add-btn")) {
                const current = e.target.closest(".annualFeeContainer");
                const clone = cloneAndReset(current);
                annualFeeList.appendChild(clone);
            }

            if (e.target.classList.contains("annualFee-remove-btn")) {
                const allContainers = annualFeeList.querySelectorAll(".annualFeeContainer");
                if (allContainers.length > 1) {
                    e.target.closest(".annualFeeContainer").remove();
                } else {
                    alert("더 이상 삭제할 수 없습니다.");
                }
            }
        });

        // 혜택 추가/삭제
        benefitList.addEventListener("click", function (e) {
            if (e.target.classList.contains("benefit-add-btn")) {
                const current = e.target.closest(".benefitContainer");
                const clone = cloneAndReset(current);
                benefitList.appendChild(clone);
            }

            if (e.target.classList.contains("benefit-remove-btn")) {
                const allContainers = benefitList.querySelectorAll(".benefitContainer");
                if (allContainers.length > 1) {
                    e.target.closest(".benefitContainer").remove();
                } else {
                    alert("최소 1개의 혜택은 있어야 합니다.");
                }
            }
        });
    });
</script>

</body>
</html>