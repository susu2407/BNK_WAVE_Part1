<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WAVE CARD ADMIN</title>
    <link rel="stylesheet" th:href="@{/css/admin/common/commonCSS.css}">
    <link rel="stylesheet" th:href="@{/css/admin/common/commonActionBarTable.css}">
    <link rel="stylesheet" th:href="@{/css/admin/config/termsRegister.css}">
    <script th:src="@{/js/admin/common/aside.js}"></script>
</head>
<div th:replace="~{admin/common/header :: header}"></div>
<div th:replace="~{admin/common/aside :: aside}"></div>
<body>
<main>
    <div class="main-container">
        <div class="page-header">
            <link rel="stylesheet" th:href="@{/css/admin/common/mainHeader.css}">
            <h1 class="page-title">약관등록</h1>
            <nav class="page-breadcrumb">
                관리자 &gt; 약관관리 &gt; 약관등록
            </nav>
        </div>
        <div id="main-content">

            <form th:action="@{/admin/config/terms/register}" method="post" enctype="multipart/form-data">
                <div class="form-wrap">
                    <!-- 1.약관명 -->
                    <section class="form-section">
                        <div class=section-header>
                            <h2>약관명 <span style="color: red">*</span></h2>
                            <p>
                                약관을 신규 등록하기 전에 동일하거나 유사한 약관이 이미 존재하는지 반드시 검색하여 확인하십시오. <br>
                                등록 후에는 즉시 서비스에 반영될 수 있으므로, 제목, 버전, 필수 여부를 신중하게 입력하십시오. <br>
                                <br>
                                예시 형식: [약관주제] - [약관명] - v.0.0.0
                                <br>
                                ( 예: 회원관리 - 개인정보방침 - v.0.1.1 )
                            </p>
                        </div>
                        <div class="section-content">
                            <div class="form-field-wrapper">
                                <label class="form-flex-wrapper">
                                    <select name="category" required>
                                        <option value="" disabled selected hidden>약관 구분을 선택하세요.</option>
                                        <option value="개인정보">개인정보 전용</option>
                                        <option value="상품">상품 전용</option>
                                        <option value="광고">광고ㆍ마케딩 전용</option>
                                        <option value="서비스">서비스 전용</option>
                                        <option value="웹">웹 이용 전용</option>
                                        <option value="앱">앱 이용 전용</option>
                                        <option value="계약ㆍ법적 고지">계약ㆍ법적 고지 전용</option>
                                        <option value="부가정책">부가정책 전용</option>
                                        <option value="운영정책">운영정책 전용</option>
                                    </select>
                                    <span class="checkbox-required">
                                        <input type="checkbox" name="isRequired">
                                        <span>필수여부</span>
                                    </span>
                                </label>
                                <label class="terms-title">
                                    <input type="text" name="title" id="titleInput" placeholder="약관명을 입력하세요.">
                                </label>
                            </div>
                            <div class="form-field-wrapper"> <!-- 이 부분은 관련 약관이 있을 때만 보이도록 하면 좋을 듯? -->
                                <p style="color: red">관련 약관이 있습니다. 중복되지 않도록 각별히 주의해주십시오.</p>
                                <p style="color: darkgray; font-size: 12px;">[ 약관명 ] - [ 버전 ] - [ 상태 ] 입니다.</p>
                                <ul id="suggestionBox" class="title-caution">
                                    <li th:each="item : ${warningList}" th:data-title="${item.title}" onclick="selectTitle(this)">
                                        <p>
                                            [[${item.title}]] - [[${item.version}]] - <span th:style="'color:' +
                                        (${item.termStatus == '활성' ? 'green' :
                                        (item.termStatus == '비활성' ? 'gray' :
                                        (item.termStatus == '퇴직' ? 'red' : 'black'))})">[[${item.termStatus}]]</span>
                                        </p>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </section>
                    <!-- 2. 약관 내용 -->
                    <section class="form-section">
                        <div class="section-header">
                            <h2>약관내용 <span style="color: red">*</span></h2>
                            <p>
                                해당 필드에 입력된 텍스트는 서비스에 법적 효력을 갖는 최종 약관 내용으로 게시됩니다. <br>
                                오탈자 및 문맥 오류가 없는지 최종 확인하십시오. <br>
                                <br>
                                기존 약관의 내용(기존 약관 내용 필드 참고)과 변경 및 추가된 내용을 비교하여 정확한지 검토하십시오.
                            </p>
                        </div>
                        <div class="section-content">
                            <div class="form-field-wrapper">
                                <label>
                                    <textarea name="content" placeholder="약관 내용을 입력하세요" class="terms-textarea"></textarea>
                                </label>
                          </div>
                        </div>
                    </section>
                  <!-- 3. 약관 파일 -->
                    <section class="form-section">
                        <div class="section-header">
                            <h2>약관 파일 <span style="color: red">*</span></h2>
                            <p>
                                약관 파일은 사용자 다운로드용 및 안내책자로 제공됩니다. <br>
                                PDF 파일만 업로드 가능합니다. (다른 형식 파일 등록 불가) <br>
                                업로드 후 '등록한 파일 미리보기' 버튼을 클릭하여 파일이 정상적으로 표시되는지 확인하고,
                                업로드하려는 약관 내용과 파일 내용이 일치하는지 최종 검토하십시오. <br>
                            </p>
                        </div>
                        <div class="section-content">
                            <!-- PDF 파일만 업로드 가능하게 제한 -->
                            <div class="file-upload-wrapper">
                                <label for="termsFile" class="custom-file-label">파일 선택</label>
                                <span id="fileNameDisplay">선택된 파일 없음</span>
                                <input type="file" name="pdfFile" id="termsFile" accept="application/pdf">
                            </div>
                            <div id="preview">
                                <!-- 등록한 파일 간단 정보 -->
                                <p id="fileName">파일명 : -</p>
                                <p id="fileSize">크기 : -</p>
                                <p id="fileType">형식 : -</p>
                                <!-- 미리보기 버튼 -->
                                <button id="previewBtn" style="display: none;" class="btn preview-btn">등록한 파일 미리보기</button>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- 주요 액션 영역 -->
                <div class="terms-action-bar ">
                    <!-- 등록버튼 -->
                    <a th:href="@{/admin/config/terms/list}" class="btn register-btn">취소</a>
                    <button class="btn register-btn">등록</button>
                </div>
            </form>
        </div>
    </div>
</main>
<div th:replace="~{admin/common/footer :: footer}"></div>
<script>
    document.getElementById("termsFile").addEventListener("change", function () {
        const file = this.files[0];
        if (!file) return;

        document.getElementById("fileName").textContent = "파일명 : " + file.name;
        document.getElementById("fileSize").textContent = "크기 : " + (file.size / 1024).toFixed(2) + " KB";
        document.getElementById("fileType").textContent = "형식 : " + file.type;

        // PDF 미리보기 설정
        if (file.type === "application/pdf") {
            const reader = new FileReader();
            reader.onload = function (e) {
                const previewBtn = document.getElementById("previewBtn");

                // 미리보기 버튼 보이기
                previewBtn.style.display = "flex";

                // 미리보기 버튼 클릭 시 새 창으로 PDF 띄우기
                previewBtn.onclick = function () {
                    // 새 창으로 PDF 파일 열기
                    const pdfWindow = window.open();
                    pdfWindow.document.write('<iframe width="100%" height="100%" src="' + e.target.result + '"></iframe>');
                };
            };
            reader.readAsDataURL(file);
        } else {
            alert("PDF 파일만 업로드 가능합니다.");
            document.getElementById("previewBtn").style.display = "none"; // 미리보기 버튼 숨기기
        }
    });

    // input[type="file"]
    document.getElementById('termsFile').addEventListener('change', function() {
        const fileNameDisplay = document.getElementById('fileNameDisplay');

        // 파일이 선택되었는지 확인
        if (this.files && this.files.length > 0) {
            // 첫 번째 파일의 이름을 가져와 표시
            fileNameDisplay.textContent = this.files[0].name;
            fileNameDisplay.style.color = '#333'; // 텍스트 색상 변경
        } else {
            // 파일 선택이 취소된 경우
            fileNameDisplay.textContent = '선택된 파일 없음';
            fileNameDisplay.style.color = '#555';
        }
    });
</script>

<script th:inline="javascript">
    const input = document.getElementById('titleInput');
    const box = document.getElementById('suggestionBox');
    const items = document.querySelectorAll('#suggestionBox > li');

    box.style.display = 'none';

    input.addEventListener('input', function() {
        const val = this.value.trim().toLowerCase();
        if (!val) return box.style.display = 'none';

        let count = 0;
        items.forEach(item => {
            const title = item.getAttribute('data-title');
            if (title && title.toLowerCase().includes(val) && count < 5) {
                item.style.display = 'block';
                count++;
            } else {
                item.style.display = 'none';
            }
        });

        box.style.display = count > 0 ? 'block' : 'none';
    });

    function selectTitle(el) {
        input.value = el.dataset.title;
        box.style.display = 'none';
    }
</script>
</body>
</html>