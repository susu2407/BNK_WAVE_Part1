<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WAVE CARD ADMIN</title>
    <link rel="stylesheet" th:href="@{/css/admin/common/commonCSS.css}">
    <link rel="stylesheet" th:href="@{/css/admin/common/commonActionBarTable.css}">
    <link rel="stylesheet" th:href="@{/css/admin/approval/approval.css}">
    <script th:src="@{/js/admin/common/aside.js}"></script>
</head>
<body>
<div th:replace="~{admin/common/header :: header}"></div>
<div th:replace="~{admin/common/aside :: aside}"></div>
<main>
    <div class="main-container">
        <div class="page-header">
            <link rel="stylesheet" th:href="@{/css/admin/common/mainHeader.css}">
            <h1 class="page-title">승인관리</h1>
            <nav class="page-breadcrumb">
                관리자 &gt; 상품관리 &gt; 승인관리 > 상품 승인
            </nav>
        </div>
        <div id="main-content">

            <!-- 탭 -->
            <div class="nav-content">
                <nav class="nav-menu">
                    <ul>
                        <li class="approval-select-area">
                            <a th:href="@{/admin/approval/card/list}" class="approval-select-a">상품 승인</a>
                        </li>
                        <li><a th:href="@{/admin/approval/terms/list}">약관 승인</a></li>
                        <li><a th:href="@{/admin/approval/member/cardList}">상품 가입 승인</a></li>
                    </ul>
                </nav>
            </div>

            <!-- 주요 액션 영역 -->
            <div class="action-bar">
                <!-- 등록버튼 -->
                <!-- 검색 -->
                <form method="get" th:action="@{/admin/approval/card/list}">
                    <div th:with="st=${param.searchType != null ? param.searchType[0] : ''}">
                        <select name="searchType" id="searchType">
                            <option value="" th:selected="${st == ''}">전체</option>
                            <option value="status" th:selected="${st == 'status'}">상태</option>
                        </select>
                    </div>

                    <input type="text" id="keyword" name="keyword" placeholder="검색어"
                           th:value="${param.keyword != null ? param.keyword[0] : ''}"/>

                    <button type="submit" class="btn search-btn">검색</button>
                </form>
            </div>

            <!-- 본문 -->
            <div class="content">
                <table>
                    <thead>
                    <tr>
                        <th>No</th>
                        <th>상품명</th>
                        <th>요청자</th>
                        <th>요청일</th>
                        <th>상태</th>
                        <th>결재일</th>
                        <th>관리</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- 페이지 객체의 content 리스트를 반복 -->
                    <tr th:each="approval, stat : ${cardApprovalList.content}">
                        <td>[[${cardApprovalList.totalElements - (cardApprovalList.number * cardApprovalList.size + stat.index)}]]</td>
                        <td>
                            [[${approval.cardId}]]
                        </td>
                        <td>[[${approval.reason}]]</td>
                        <td>[[${#temporals.format(approval.requestedAt, 'yyyy-MM-dd')}]]</td>
                        <td>[[${approval.status}]]</td>
                        <td>[[${#temporals.format(approval.approvedAt, 'yyyy-MM-dd')}]]</td>
                        <td th:if="${approval.status == '대기'}">
                            <a th:href="@{/admin/approval/card/approval(cardId=${approval.approvalId})}">승인</a> <br>
                            <a th:href="@{/admin/approval/card/rejection(cardId=${approval.approvalId})}">반려</a> <br>
                        </td>
                        <td th:unless="${approval.status == '대기' }">
                            <a>결재완료 - [[${approval.status}]]</a>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>


            <!-- 페이징 -->
            <div class="pagination" th:with="
                page=${cardApprovalList},
                now=${page.number},
                total=${page.totalPages},
                size=${page.size},
                block=${5},
                start=${(now / block) * block},
                end=${ ((total - 1) < (start + block - 1)) ? (total - 1) : (start + block - 1) },
                prev=${ (now > 0) ? (now - 1) : 0 },
                next=${ ((now + 1) < total) ? (now + 1) : (total - 1) },
                st=${param.searchType != null ? param.searchType[0] : ''},
                kw=${param.keyword != null ? param.keyword[0] : ''},
                ans=${param.answered != null ? param.answered[0] : ''}
             ">
                <div th:if="${total > 0}">
                    <a th:href="@{|?page=0&size=${size}&searchType=${st}&keyword=${kw}}"
                       th:classappend="${page.first} ? ' disabled'">« 처음</a>

                    <a th:href="@{|?page=${prev}&size=${size}&searchType=${st}&keyword=${kw}}"
                       th:classappend="${page.first} ? ' disabled'">‹ 이전</a>

                    <th:block th:each="i : ${#numbers.sequence(start, end)}">
                        <a th:href="@{|?page=${i}&size=${size}&searchType=${st}&keyword=${kw}}"
                           th:classappend="${i == now} ? ' active'">[[${i + 1}]]</a>
                    </th:block>

                    <a th:href="@{|?page=${next}&size=${size}&searchType=${st}&keyword=${kw}}"
                       th:classappend="${page.last} ? ' disabled'">다음 ›</a>

                    <a th:href="@{|?page=${total - 1}&size=${size}&searchType=${st}&keyword=${kw}}"
                       th:classappend="${page.last} ? ' disabled'">마지막 »</a>
                </div>
            </div>
        </div>
    </div>
</main>
<div th:replace="~{admin/common/footer :: footer}"></div>
</body>
</html>