<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ïπ¥Îìú Î™©Î°ù</title>
    <link rel="stylesheet" th:href="@{/css/member/card/list.css}">
</head>

<body>

<!-- Í≥µÌÜµ Ìó§Îçî -->
<div th:replace="~{common/header :: header}"></div>

<main>
    <div class="main-container">
        <div id="main-content">

            <section class="card-page">

                <!-- ÌïÑÌÑ∞ Î≤ÑÌäº -> Ï≤¥ÌÅ¨ Î∞ïÏä§ Î≥ÄÍ≤Ω-->
                <div class="card-filter" id="filterArea">
                    <!-- ‚òÖ labelÏóê filter-btn ÌÅ¥ÎûòÏä§Î•º Ï§òÏÑú Í∏∞Ï°¥ Î≤ÑÌäº Ïä§ÌÉÄÏùº Í∑∏ÎåÄÎ°ú ÏÇ¨Ïö© -->
                    <label class="filter-btn">
                        <input type="checkbox" class="filter-checkbox" data-filter="Ïó¨Ìñâ">
                        <span>Ïó¨Ìñâ</span>
                    </label>

                    <label class="filter-btn">
                        <input type="checkbox" class="filter-checkbox" data-filter="ÏáºÌïë">
                        <span>ÏáºÌïë</span>
                    </label>

                    <label class="filter-btn">
                        <input type="checkbox" class="filter-checkbox" data-filter="ÎèÑÏÑú">
                        <span>ÎèÑÏÑú</span>
                    </label>

                    <label class="filter-btn">
                        <input type="checkbox" class="filter-checkbox" data-filter="ÏùåÏãù">
                        <span>ÏùåÏãù</span>
                    </label>

                    <label class="filter-btn">
                        <input type="checkbox" class="filter-checkbox" data-filter="Ï£ºÏú†">
                        <span>Ï£ºÏú†</span>
                    </label>

                    <label class="filter-btn">
                        <input type="checkbox" class="filter-checkbox" data-filter="Ìè¨Ïù∏Ìä∏/Ï∫êÏâ¨Î∞±/ÎßàÏùºÎ¶¨ÏßÄ">
                        <span>Ìè¨Ïù∏Ìä∏/Ï∫êÏâ¨Î∞±/ÎßàÏùºÎ¶¨ÏßÄ</span>
                    </label>

                    <label class="filter-btn">
                        <input type="checkbox" class="filter-checkbox" data-filter="Î¨¥Ïù¥ÏûêÌï†Î∂Ä">
                        <span>Î¨¥Ïù¥ÏûêÌï†Î∂Ä</span>
                    </label>

                    <label class="filter-btn">
                        <input type="checkbox" class="filter-checkbox" data-filter="ÎÜÄÏù¥Í≥µÏõê">
                        <span>ÎÜÄÏù¥Í≥µÏõê</span>
                    </label>

                    <label class="filter-btn">
                        <input type="checkbox" class="filter-checkbox" data-filter="ÌÜµÏã†/Ïù∏ÌÑ∞ÎÑ∑">
                        <span>ÌÜµÏã†/Ïù∏ÌÑ∞ÎÑ∑</span>
                    </label>

                    <label class="filter-btn">
                        <input type="checkbox" class="filter-checkbox" data-filter="APTÍ¥ÄÎ¶¨ÎπÑÌï†Ïù∏">
                        <span>APTÍ¥ÄÎ¶¨ÎπÑÌï†Ïù∏</span>
                    </label>

                    <label class="filter-btn">
                        <input type="checkbox" class="filter-checkbox" data-filter="ÌõÑÎ∂àÍµêÌÜµÍ∏∞Îä•/ÍµêÌÜµÌï†Ïù∏">
                        <span>ÌõÑÎ∂àÍµêÌÜµÍ∏∞Îä•/ÍµêÌÜµÌï†Ïù∏</span>
                    </label>

                    <label class="filter-btn">
                        <input type="checkbox" class="filter-checkbox" data-filter="Í∏∞ÌÉÄ">
                        <span>Í∏∞ÌÉÄ</span>
                    </label>

                    <label class="filter-btn">
                        <input type="checkbox" class="filter-checkbox" data-filter="VIP">
                        <span>VIP</span>
                    </label>
                </div>

                <div class="list-wrapper">

                    <h2 class="list-title" id="listTitle">Ï∂îÏ≤ú Ïπ¥Îìú</h2>

                    <!-- Ïπ¥Îìú Î¶¨Ïä§Ìä∏ -->
                    <div class="card-list" id="cardList">

                        <!-- ‚òÖ ÌÉÄÏûÑÎ¶¨ÌîÑ Ïπ¥Îìú Î∞òÎ≥µ ‚òÖ -->
                        <th:block th:each="item : ${cards}">

                            <article class="card-item"
                                     th:data-category="${item.categoryString}">

                                <!-- Ïπ¥Îìú Ïù¥ÎØ∏ÏßÄ -->
                                <div class="card-thumb">
                                    <img th:src="@{'/' + ${item.card.thumbnail}}"
                                         th:alt="${item.card.name}">
                                </div>

                                <!-- Ïπ¥Îìú Í∏∞Î≥∏ Ï†ïÎ≥¥ -->
                                <div class="card-body">
                                    <h3 class="card-name" th:text="${item.card.name}">Ïπ¥Îìú Ïù¥Î¶Ñ</h3>
                                    <p class="card-desc" th:text="${item.card.description}">
                                        ÏÑ§Î™Ö
                                    </p>
                                </div>

                                <!-- ÏÉÅÏÑ∏Î≥¥Í∏∞ -->
                                <div class="card-actions">
                                    <a class="detail-btn"
                                       th:href="@{/card/view2(cardId=${item.card.cardId})}">
                                        ÏûêÏÑ∏Ìûà Î≥¥Í∏∞
                                    </a>
                                </div>

                            </article>

                        </th:block>

                    </div>
                </div>
            </section>

        </div>
    </div>
</main>

<!-- Í≥µÌÜµ Ìë∏ÌÑ∞ -->
<div th:replace="~{common/footer :: footer}"></div>


<!-- Ìó§Îçî/Ìë∏ÌÑ∞ JS (ÌïÑÏöî Ïãú Ïú†ÏßÄ) -->
<script>
    document.addEventListener('DOMContentLoaded', function () {

        // header Î°úÎìú
        fetch('../common/header.html')
            .then(res => res.text())
            .then(html => {
                const headerWrapper = document.getElementById('header');
                if (headerWrapper) {
                    headerWrapper.innerHTML = html;
                }
            });

        // footer Î°úÎìú
        fetch('../common/footer.html')
            .then(res => res.text())
            .then(html => {
                const footerWrapper = document.getElementById('footer');
                if (footerWrapper) {
                    footerWrapper.innerHTML = html;
                }
            });
    });
</script>

<script>
    // Ïπ¥Îìú ÌïÑÌÑ∞ÎßÅ JS (Ï≤¥ÌÅ¨Î∞ïÏä§ Îã§Ï§ë ÏÑ†ÌÉù Î≤ÑÏ†Ñ)
    document.addEventListener("DOMContentLoaded", () => {
        // 1) Ï≤¥ÌÅ¨Î∞ïÏä§Îì§ Ï†ÑÎ∂Ä Í∞ÄÏ†∏Ïò§Í∏∞
        const checkboxes = document.querySelectorAll(".filter-checkbox");
        // 2) Ïπ¥ÎìúÎì§ Ï†ÑÎ∂Ä Í∞ÄÏ†∏Ïò§Í∏∞
        const cards = document.querySelectorAll(".card-item");
        // 3) Ï†úÎ™© ÏöîÏÜå
        const listTitle = document.getElementById("listTitle");

        // üîπ ÌïÑÌÑ∞ Ï†ÅÏö© Ìï®Ïàò (Ï≤¥ÌÅ¨Î∞ïÏä§ ÏÉÅÌÉúÍ∞Ä Î∞îÎÄî ÎïåÎßàÎã§ Ìò∏Ï∂ú)
        function applyFilter() {
            // 1. ÏÑ†ÌÉùÎêú Ïπ¥ÌÖåÍ≥†Î¶¨ Î™©Î°ù ÎßåÎì§Í∏∞
            const selectedCategories = Array.from(checkboxes)
                .filter(cb => cb.checked)                              // Ï≤¥ÌÅ¨Îêú Í≤ÉÎßå
                .map(cb => cb.getAttribute("data-filter"));            // data-filter Í∞í Î∞∞Ïó¥Î°ú

            // 2. Ïπ¥Îìú Î≥¥Ïó¨Ï£ºÍ∏∞ / Ïà®Í∏∞Í∏∞ + Î≥¥Ïù¥Îäî Ïπ¥Îìú Í∞úÏàò ÏÑ∏Í∏∞
            let visibleCount = 0; // ÌôîÎ©¥Ïóê Î≥¥Ïó¨ÏßÄÎäî Ïπ¥Îìú Í∞úÏàò

            cards.forEach(card => {
                const categoryData = card.getAttribute("data-category") || ""; // "Ïó¨Ìñâ,ÏùåÏãù,Ï£ºÏú†" Ïù¥Îü∞ Î¨∏ÏûêÏó¥

                // ÏïÑÎ¨¥Í≤ÉÎèÑ ÏÑ†ÌÉù Ïïà ÌñàÏúºÎ©¥ Ï†ÑÏ≤¥ Î≥¥Ïó¨Ï£ºÍ∏∞
                if (selectedCategories.length === 0) {
                    card.style.display = "";
                    visibleCount++;        // Î≥¥Ïó¨Ï£ºÎãàÍπå +1
                    return;
                }

                // ÌïòÎÇòÎùºÎèÑ Ìè¨Ìï®ÎêòÎ©¥ Î≥¥Ïó¨Ï£ºÍ∏∞ (OR Ï°∞Í±¥)
                const shouldShow = selectedCategories.some(cat => categoryData.includes(cat));

                if (shouldShow) {
                    card.style.display = "";
                    visibleCount++;        // Î≥¥Ïó¨Ï£ºÎäî Ïπ¥ÎìúÎ©¥ +1
                } else {
                    card.style.display = "none";
                }
            });

            // 3. Ï†úÎ™© Î≥ÄÍ≤Ω: "ÏÑ†ÌÉùÎêú NÍ∞úÏùò Ïπ¥Îìú"
            if (listTitle) {

                if (selectedCategories.length ===0) {
                    // Ï≤¥ÌÅ¨ Ïπ¥Îìú Î™®Îëê ÎØ∏ÏÑ†ÌÉù -> "Ï∂îÏ≤úÏπ¥Îìú" (ÏûÑÏãú)
                    listTitle.textContent = "Ï∂îÏ≤ú Ïπ¥Îìú"

                }else if (visibleCount === 0) {
                    // ÌïÑÌÑ∞Îäî ÏÑ†ÌÉùÎêêÎäîÎç∞, Ï°∞Í±¥Ïóê ÎßûÎäî Ïπ¥ÎìúÍ∞Ä ÌïòÎÇòÎèÑ ÏóÜÏùÑ Îïå
                    listTitle.textContent = "Ï°∞Í±¥Ïóê ÎßûÎäî Ïπ¥ÎìúÍ∞Ä ÏóÜÏäµÎãàÎã§";
                } else {
                    listTitle.textContent = `ÏÑ†ÌÉùÎêú ${visibleCount}Í∞úÏùò Ïπ¥Îìú`;
                    // Ïòà: ÏÑ†ÌÉùÎêú 3Í∞úÏùò Ïπ¥Îìú
                }
            }

            // 4. Ï≤¥ÌÅ¨Îêú Ï≤¥ÌÅ¨Î∞ïÏä§Ïùò labelÏóê active ÌÅ¥ÎûòÏä§ Îã¨ÏïÑÏ£ºÍ∏∞ (Ïä§ÌÉÄÏùºÏö©)
            checkboxes.forEach(cb => {
                const label = cb.closest(".filter-btn");
                if (!label) return;

                if (cb.checked) {
                    label.classList.add("active");
                } else {
                    label.classList.remove("active");
                }
            });
        }

        // üîπ Ï≤¥ÌÅ¨Î∞ïÏä§ change Ïù¥Î≤§Ìä∏Ïóê ÌïÑÌÑ∞ Ìï®Ïàò Ïó∞Í≤∞
        checkboxes.forEach(cb => {
            cb.addEventListener("change", applyFilter);
        });

        // üîπ Ï≤´ Î°úÎìú Ïãú Ìïú Î≤à Ï†ÑÏ≤¥ Î≥¥Ïó¨Ï£ºÍ∏∞
        applyFilter();
    });
</script>

</body>
</html>
