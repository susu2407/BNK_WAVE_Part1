<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WAVE CARD</title>

    <!-- 공통 헤더/푸터 -->
<!--    <link rel="stylesheet" href="../css/common/product_header_style.css" />-->
<!--    <link rel="stylesheet" href="../css/common/footer_style.css" />-->

    <!-- 약관 전용 CSS -->
    <link rel="stylesheet" th:href="@{/css/member/member/Terms.css}">
</head>

<body>
    <div th:replace="~{common/product_header :: product_header}"></div>

    <main class="content">
        <section class="terms-wrap">
            <h1 class="terms-title">약관에 동의해 주세요</h1>

            <section class="agree-section">
                <!-- 전체 동의 영역 -->
                <div class="agree-all-row">
                    <button type="button" class="agree-all-btn" aria-pressed="false">
                        <span class="agree-check" aria-hidden="true"></span>
                        <span class="agree-all-title">전체 동의</span>
                    </button>
                </div>

                <!-- 개별 약관 리스트 박스 -->
                <div class="agree-list-box">

                    <!-- 1. 회원약관 (필수) -->
                    <div class="agree-row" data-required="true">
                        <div class="agree-head" aria-expanded="false">
                            <span class="left">
                                <span class="agree-check" aria-hidden="true"></span>
                                회원약관 (필수)
                            </span>
                            <span class="right" aria-hidden="true">›</span>
                        </div>
                        <div class="agree-body">
                            <div class="agree-body-desc">
                                서비스 이용에 관한 기본 조항, 계정, 게시물, 금지행위, 책임 제한 등에 대한 내용이 포함됩니다.
                            </div>
                            <ul>
                                <li>회원은 타인의 권리를 침해할 수 없습니다.</li>
                                <li>서비스는 “있는 그대로(as-is)” 제공됩니다.</li>
                                <li>이용정지 및 해지, 분쟁 해결 절차 등.</li>
                            </ul>
                        </div>
                    </div>

                    <!-- 2. 개인정보처리취급방침 (필수) -->
                    <div class="agree-row" data-required="true">
                        <div class="agree-head" aria-expanded="false">
                            <span class="left">
                                <span class="agree-check" aria-hidden="true"></span>
                                개인정보처리취급방침 (필수)
                            </span>
                            <span class="right" aria-hidden="true">›</span>
                        </div>
                        <div class="agree-body">
                            <div class="agree-body-desc">
                                수집 항목, 이용 목적, 보관 및 파기, 제3자 제공, 처리위탁, 권리 및 행사 방법에 대한 안내입니다.
                            </div>
                            <ul>
                                <li>수집항목: 회원가입/서비스 제공에 필요한 최소정보.</li>
                                <li>보관기간: 목적 달성 후 즉시 파기(법령 예외 보관 제외).</li>
                                <li>개인정보 열람/정정/삭제/처리정지 요구권.</li>
                            </ul>
                        </div>
                    </div>

                </div>

                <!-- 진행 버튼 -->
                <button type="button" class="btn-submit" id="btnProceed" disabled>동의하고 진행</button>
            </section>
        </section>
    </main>

    <div th:replace="~{common/footer :: footer}"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            /* 공통 헤더/푸터 로드 */
            fetch('../common/product_header.html')
                .then(r => r.text())
                .then(h => {
                    document.getElementById('header').innerHTML = h;
                });

            fetch('../common/footer.html')
                .then(r => r.text())
                .then(h => {
                    document.getElementById('footer').innerHTML = h;
                });

            const allBtn = document.querySelector('.agree-all-btn');
            const allIcon = allBtn.querySelector('.agree-check');   // 전체 동의 동그라미
            const rows = document.querySelectorAll('.agree-row');
            const btnNext = document.getElementById('btnProceed');

            // 필수 약관 모두 체크됐는지
            function allRequiredChecked() {
                return Array.from(rows)
                    .filter(r => r.dataset.required === 'true')
                    .every(r => r.querySelector('.agree-check').classList.contains('on'));
            }

            // 전체동의 아이콘 + 진행 버튼 상태 동기화
            function syncAllAndButton() {
                const everyOn = Array.from(rows)
                    .every(r => r.querySelector('.agree-check').classList.contains('on'));

                allIcon.classList.toggle('on', everyOn);
                btnNext.disabled = !allRequiredChecked();
            }

            // 개별 약관 행 이벤트 (product_register3 패턴)
            rows.forEach(row => {
                const head = row.querySelector('.agree-head');
                const left = head.querySelector('.left');          // 체크/문구 영역
                const chev = head.querySelector('.right');         // 펼치기 화살표
                const icon = head.querySelector('.agree-check');   // 동그라미
                const body = row.querySelector('.agree-body');

                if (!head || !left || !chev || !icon || !body) return;

                // 초기 상태 : 접힘
                head.setAttribute('aria-expanded', 'false');
                body.classList.remove('open');

                // 왼쪽(동그라미+문구) 클릭 → 체크 토글만
                left.addEventListener('click', (e) => {
                    e.stopPropagation();
                    icon.classList.toggle('on');
                    syncAllAndButton();
                });

                // 오른쪽 화살표 클릭 → 펼치기/접기만
                chev.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const opened = head.getAttribute('aria-expanded') === 'true';
                    if (opened) {
                        head.setAttribute('aria-expanded', 'false');
                        body.classList.remove('open');
                    } else {
                        head.setAttribute('aria-expanded', 'true');
                        body.classList.add('open');
                    }
                });
            });

            // 전체 동의 버튼 → 모든 동그라미 on/off (펼치기는 건드리지 않음)
            allBtn.addEventListener('click', () => {
                const willCheck = !allIcon.classList.contains('on');
                allIcon.classList.toggle('on', willCheck);

                rows.forEach(row => {
                    const icon = row.querySelector('.agree-head .agree-check');
                    if (icon) {
                        icon.classList.toggle('on', willCheck);
                    }
                });

                syncAllAndButton();
            });

            // 초기 상태 반영
            syncAllAndButton();

            // 진행 버튼 클릭
            btnNext.addEventListener('click', () => {
                alert('필수 약관에 동의하셨습니다. 다음 단계로 진행합니다.');
                // TODO: 다음 페이지로 이동 / 폼 제출 등 로직 추가
            });
        });
    </script>
</body>

</html>